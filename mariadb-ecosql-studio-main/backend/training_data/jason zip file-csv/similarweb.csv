"question","answer"
"what are the year on year total visits on Tesla and ford from 2018 to 2023 ? Convert varchar to date using to date function , Plot a line chart ","SELECT company_name,
       extract(year
FROM   to_date(date, 'YYYY-MM-DD')) as year, sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%Tesla%'
    or company_name = 'Ford')
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2023-12-31'
GROUP BY company_name, extract(year
FROM   to_date(date, 'YYYY-MM-DD'))
ORDER BY company_name, year;"
"Which 10 domains received the highest amount of traffic on Black Friday in 2021 vs 2020","SELECT domain,
       sum(case when date = '2021-11-26' then total_visits
                else 0 end) as visits_2021,
       sum(case when date = '2020-11-27' then total_visits
                else 0 end) as visits_2020
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date in ('2021-11-26', '2020-11-27')
GROUP BY domain
ORDER BY (visits_2021 - visits_2020) desc limit 10"
"what are mobile visits for total visits for Coca Cola vs Pepsi in 2021 ?","SELECT 'Coca Cola' as company,
       sum(mobile_visits) as mobile_visits_2021,
       sum(total_visits) as total_visits_2021
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%Coca Cola%'
   and date between '2021-01-01'
   and '2021-12-31'
UNION
SELECT 'Pepsi' as company,
       sum(mobile_visits) as mobile_visits_2021,
       sum(total_visits) as total_visits_2021
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%Pepsi%'
   and date between '2021-01-01'
   and '2021-12-31'"
"What's the average visit duration by date for each GOOGL domain?","```
SELECT DATE, DOMAIN, AVG(TOTAL_AVG_VISIT_DURATION) AS AVG_VISIT_DURATION
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500
WHERE TICKER = 'GOOGL'
GROUP BY DATE, DOMAIN
ORDER BY DATE ASC
```"
"what are mobile visits for Expedia  from 2010 to 2021  ? Convert date from varchar to date using to date function ","SELECT sum(mobile_visits) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%expedia%'
   and to_date(date, 'YYYY-MM-DD') between '2010-01-01'
   and '2021-12-31';"
"What is the highest traffic domain for each ticker and what’s the YoY growth rate for the top 10 fastest / slowest growing","with ticker_max_traffic as (SELECT ticker,
                                   domain,
                                   max(total_visits) as max_traffic
                            FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                            GROUP BY ticker, domain), traffic_data as (SELECT domain,
                                                  extract(year
                                           FROM   cast(date as date)) as year, sum(total_visits) as total_visits
                                           FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                                           GROUP BY domain, extract(year
                                           FROM   cast(date as date))), yoy_data as (SELECT current_year.domain,
                                                 current_year.year,
                                                 (current_year.total_visits - previous_year.total_visits) / cast(previous_year.total_visits as float) as yoy_growth
                                          FROM   traffic_data as current_year join traffic_data as previous_year
                                                  ON current_year.domain = previous_year.domain and
                                                     current_year.year = previous_year.year + 1), ranked_data as (SELECT domain,
                                                                    avg(yoy_growth) as avg_yoy_growth
                                                             FROM   yoy_data
                                                             GROUP BY domain)
SELECT ticker_max_traffic.ticker,
       ticker_max_traffic.domain,
       ticker_max_traffic.max_traffic,
       ranked_data.avg_yoy_growth
FROM   ticker_max_traffic join ranked_data
        ON ticker_max_traffic.domain = ranked_data.domain
ORDER BY ranked_data.avg_yoy_growth desc limit 10"
"which domains received the highest amount of traffic in the month of November?","SELECT domain,
       sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date between '2021-11-01'
   and '2021-11-30'
GROUP BY domain
ORDER BY total_visits desc limit 10"
"which domains received the highest amount of traffic in the month of November on the 26th and 29th?","SELECT domain,
       sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date in ('2021-11-26', '2021-11-29')
GROUP BY domain
ORDER BY total_visits desc"
"How many domains are there for AMZN?","SELECT COUNT(DISTINCT DOMAIN) AS NUM_DOMAINS
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500
WHERE TICKER = 'AMZN'"
"What are the top 5 domains that had the highest percentage of mobile visits to total visits?","```
SELECT DOMAIN, 
    ROUND(MOBILE_VISITS*100.0/TOTAL_VISITS,2) AS MOBILE_PERCENTAGE 
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500 
ORDER BY MOBILE_PERCENTAGE DESC 
LIMIT 5
```"
"what are different company names ?","SELECT DISTINCT(company_name)
FROM   datafeeds.sp_500"
"what are mobile visits for Google  from 2001 to 2010  ? Convert date from varchar to date using to date function ","SELECT sum(mobile_visits) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%google%'
   and to_date(date, 'YYYY-MM-DD') between  '2010-12-31' and '2021-01-01';"
"Which ticker does google.com belong to?","```
SELECT TICKER 
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500 
WHERE DOMAIN = 'google.com'
```"
"what are the year on year total visits on ebay and amazon from 2018 to 2021? Convert varchar to date using to date function , Plot a line chart ","SELECT company_name,
       extract(year
FROM   to_date(date, 'YYYY-MM-DD')) as year, sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%ebay%'
    or company_name ilike '%amazon%')
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2021-12-31'
GROUP BY company_name, extract(year
FROM   to_date(date, 'YYYY-MM-DD'))
ORDER BY company_name, year;"
"in 2022, which 10 domains had the highest total time spent (visits x duration) with web and mobile combined?","I'm sorry, it seems that the error message you provided is not related to a valid SQL query. Please provide the full SQL query along with the error message so that I can assist you better."
"which 2 companies had the highest abolsute mobile visit growth from 2018 to 2021 ?","with mobile_visits as (SELECT company_name,
                              date_trunc('year', to_date(date, 'YYYY-MM-DD')) as year,
                              sum(mobile_visits) as mobile_visits
                       FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                       WHERE  company_name ilike '%coca-cola%'
                           or company_name ilike '%pepsi%'
                          and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
                          and '2021-12-31'
                       GROUP BY company_name, year), mobile_visits_growth as (SELECT company_name,
                                                              year,
                                                              mobile_visits,
                                                              lag(mobile_visits) OVER (PARTITION BY company_name
                                                                                       ORDER BY year) as prev_mobile_visits
                                                       FROM   mobile_visits)
SELECT company_name,
       max(mobile_visits - prev_mobile_visits) as max_mobile_growth
FROM   mobile_visits_growth
GROUP BY company_name
ORDER BY max_mobile_growth desc limit 2;"
"Which  are the top 10 domains  that had the highest  mobile traffic in 2022 and 2021 in billions?","SELECT domain,
       round(sum(case when date between '2021-01-01' and
                           '2021-12-31' then mobile_visits
                      else 0 end) / 1000000000, 2) as mobile_traffic_2021_billion,
       round(sum(case when date between '2022-01-01' and
                           '2022-12-31' then mobile_visits
                      else 0 end) / 1000000000, 2) as mobile_traffic_2022_billion
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
GROUP BY domain
ORDER BY mobile_traffic_2022_billion desc, mobile_traffic_2021_billion desc limit 10"
"Which domains  had the highest  mobile traffic between 2022 and 2021?","One way to correct this error is to add a `NULLIF` function to the denominator of the division operation. This will return NULL instead of throwing a division by zero error if the denominator is zero. Here's the corrected query:

```
SELECT domain,
       sum(case when date between '2021-01-01' and
                     '2021-12-31' then mobile_visits
                else 0 end) as mobile_visits_2021,
       sum(case when date between '2022-01-01' and
                     '2022-12-31' then mobile_visits
                else 0 end) as mobile_visits_2022,
       (sum(case when date between '2022-01-01' and
                      '2022-12-31' then mobile_visits
                 else 0 end) - sum(case when date between '2021-01-01' and
                      '2021-12-31' then mobile_visits
                 else 0 end)) / NULLIF(sum(case when date between '2021-01-01' and
                      '2021-12-31' then mobile_visits
                 else 0 end), 0) as mobile_growth
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
GROUP BY domain
ORDER BY mobile_growth desc limit 10
```"
"what are mobile visits for Google in 2020 ? ","SELECT sum(mobile_visits) as mobile_visits_2020
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  domain = 'www.google.com'
   and date between '2020-01-01'
   and '2020-12-31';"
"SELECT 10 rows from the data set","SELECT * FROM datafeeds.SP_500 
LIMIT 10"
"What is the max traffic domain for each ticker and  the YoY growth rate for the top 10 fastest or slowest growing domains?","with ticker_max_traffic as (SELECT ticker,
                                   domain,
                                   max(total_visits) as max_traffic
                            FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                            GROUP BY ticker, domain), traffic_data as (SELECT domain,
                                                  extract(year
                                           FROM   cast(date as date)) as year, sum(total_visits) as total_visits
                                           FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                                           GROUP BY domain, extract(year
                                           FROM   cast(date as date))), yoy_data as (SELECT current_year.domain,
                                                 current_year.year,
                                                 (current_year.total_visits - previous_year.total_visits) / cast(previous_year.total_visits as float) as yoy_growth
                                          FROM   traffic_data as current_year join traffic_data as previous_year
                                                  ON current_year.domain = previous_year.domain and
                                                     current_year.year = previous_year.year + 1), ranked_data as (SELECT domain,
                                                                    avg(yoy_growth) as avg_yoy_growth
                                                             FROM   yoy_data
                                                             GROUP BY domain)
SELECT ticker_max_traffic.ticker,
       ticker_max_traffic.domain,
       ticker_max_traffic.max_traffic,
       ranked_data.avg_yoy_growth
FROM   ticker_max_traffic join ranked_data
        ON ticker_max_traffic.domain = ranked_data.domain
ORDER BY ranked_data.avg_yoy_growth desc limit 10;"
"what are average mobile v/s desktop visit duration for netflix from year 2018 to 2021.","SELECT extract(year
FROM   to_date(date, 'YYYY-MM-DD')) as year, avg(mobile_avg_visit_duration) as avg_mobile_visit_duration, avg(desktop_avg_visit_duration) as avg_desktop_visit_duration
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%netflix%'
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2021-12-31'
GROUP BY 1;"
"How many domains are there for AMZN? List them by desktop traffic","SELECT DOMAIN, DESKTOP_VISITS 
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500
WHERE TICKER = 'AMZN'
ORDER BY DESKTOP_VISITS DESC"
"which company has the most difference between mobile visits and desktop visits in the year 2021 ?","SELECT company_name,
       sum(mobile_visits) as mobile_visits_2021,
       sum(desktop_visits) as desktop_visits_2021,
       sum(mobile_visits) - sum(desktop_visits) as diff_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date between '2021-01-01'
   and '2021-12-31'
GROUP BY company_name
ORDER BY diff_visits desc limit 1"
"SELECT are different company names ?","SELECT DISTINCT(company_name) FROM datafeeds.sp_500"
"Which domains had the highest  mobile traffic in 2022 and 2021?","SELECT domain,
       sum(case when date between '2021-01-01' and
                     '2021-12-31' then mobile_visits
                else 0 end) as mobile_visits_2021,
       sum(case when date between '2022-01-01' and
                     '2022-12-31' then mobile_visits
                else 0 end) as mobile_visits_2022
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
GROUP BY domain
ORDER BY (mobile_visits_2021 + mobile_visits_2022) desc limit 10"
"get the total duration by visits, spent on google.com in 2022 ","The corrected SQL query is:

```
SELECT (total_avg_visit_duration * total_visits) as total_duration,
DATE_TRUNC('month', CAST(date AS DATE)) as month
FROM s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE domain = 'google.com' and date between '2022-01-01' and '2022-12-31'
GROUP BY total_duration, month
ORDER BY month;
```

The error occurred because the `total_avg_visit_duration` column was used in the SELECT clause without being included in the GROUP BY clause. Therefore, I added `total_duration` to the GROUP BY clause."
"Compare total traffic to GOOGL domains to MSFT domains grouped by date","```
SELECT DATE,
    SUM(CASE WHEN TICKER = 'GOOGL' THEN TOTAL_VISITS ELSE 0 END) AS GOOGL_VISITS,
    SUM(CASE WHEN TICKER = 'MSFT' THEN TOTAL_VISITS ELSE 0 END) AS MSFT_VISITS
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500
WHERE TICKER IN ('GOOGL', 'MSFT')
GROUP BY DATE
ORDER BY DATE ASC
```"
"which country has the highest mobile visits on Coca Cola in 2020 V/s which country has highest mobile visits on Pepsi in 2020? Convert date from varchar to date using to date function ","SELECT country,
       sum(mobile_visits) as mobile_visits_2020
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%coca-cola%' or company_name ilike '%pepsi%')
   and to_date(date, 'YYYY-MM-DD') between '2020-01-01'
   and '2020-12-31'
GROUP BY country
ORDER BY mobile_visits_2020 desc limit 1;"
"Compare visits to google.com vs bing.com over time","```
SELECT DATE,
    SUM(CASE WHEN DOMAIN = 'google.com' THEN TOTAL_VISITS ELSE 0 END) AS GOOGLE_VISITS,
    SUM(CASE WHEN DOMAIN = 'bing.com' THEN TOTAL_VISITS ELSE 0 END) AS BING_VISITS
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500
WHERE DOMAIN IN ('google.com', 'bing.com')
GROUP BY DATE
ORDER BY DATE ASC
```"
"what are the year on year total visits on Tesla and general mills from 2018 to 2021 ? Convert varchar to date using to date function , Plot a line chart ","SELECT company_name,
       extract(year
FROM   to_date(date, 'YYYY-MM-DD')) as year, sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%tesla%'
    or company_name ilike '%general mills%')
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2021-12-31'
GROUP BY company_name, extract(year
FROM   to_date(date, 'YYYY-MM-DD'))
ORDER BY company_name, year;"
"Plot year on year %growth of mobile visits on Alphabet","SELECT date_trunc('year', to_date(date, 'YYYY-MM-DD')) as year,
       sum(mobile_visits) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%alphabet%'
   and date_trunc('year', to_date(date, 'YYYY-MM-DD')) between '2010-01-01'
   and '2021-12-31'
GROUP BY date_trunc('year', to_date(date, 'YYYY-MM-DD'))
ORDER BY year;"
"select the top 10 fastest-growing or slowest-growing domains based on YoY growth rate as a percentage.","The issue is that the `extract()` function cannot be used on a `VARCHAR(16777216)` column. The `date` column needs to be cast as a date type before using the `extract()` function. Here is the corrected SQL code:

```
with traffic_data as (
    SELECT domain,
           extract(year FROM cast(date as date)) as year, 
           sum(total_visits) as total_visits
    FROM s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
    GROUP BY domain, extract(year FROM cast(date as date))
), 
yoy_data as (
    SELECT current_year.domain,
           current_year.year,
           (current_year.total_visits - previous_year.total_visits) / cast(previous_year.total_visits as float) as yoy_growth
    FROM traffic_data as current_year 
    join traffic_data as previous_year
        ON current_year.domain = previous_year.domain and
           current_year.year = previous_year.year + 1
), 
ranked_data as (
    SELECT domain,
           100 * (exp(avg(log(abs(yoy_growth) + 1, 2)))) - 100 as avg_yoy_growth_pct
    FROM yoy_data
    GROUP BY domain
)
SELECT domain,
       avg_yoy_growth_pct
FROM ranked_data
ORDER BY avg_yoy_growth_pct desc limit 10;
```"
"What are the first 10 rows in the table that tells me about mobile, desktop, and total visits by domain and ticker?","SELECT COMPANY_NAME, TICKER, DOMAIN, DATE, COUNTRY, DESKTOP_VISITS, DESKTOP_BOUNCE_RATE, DESKTOP_AVG_VISIT_DURATION, DESKTOP_PAGES_PER_VISIT, MOBILE_VISITS, MOBILE_BOUNCE_RATE, MOBILE_AVG_VISIT_DURATION, MOBILE_PAGES_PER_VISIT, TOTAL_VISITS, TOTAL_BOUNCE_RATE, TOTAL_AVG_VISIT_DURATION, TOTAL_PAGES_PER_VISIT
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500
LIMIT 10"
"Which domains  had the highest  mobile traffic in 2022 and 2021 in billions?","SELECT domain,
       round(sum(case when date between '2021-01-01' and
                           '2021-12-31' then mobile_visits
                      else 0 end) / 1000000000, 2) as mobile_traffic_2021_billion,
       round(sum(case when date between '2022-01-01' and
                           '2022-12-31' then mobile_visits
                      else 0 end) / 1000000000, 2) as mobile_traffic_2022_billion
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
GROUP BY domain
ORDER BY (mobile_traffic_2021_billion + mobile_traffic_2022_billion) desc limit 10"
"Plot mobile and desktop visits year on year for activision bliizard","SELECT date_trunc('year', to_date(date, 'YYYY-MM-DD')) as year,
       sum(desktop_visits) as desktop_visits,
       sum(mobile_visits) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%activision blizzard%'
   and date_trunc('year', to_date(date, 'YYYY-MM-DD')) between '2010-01-01'
   and '2021-12-31'
GROUP BY date_trunc('year', to_date(date, 'YYYY-MM-DD'))
ORDER BY year;"
"what are mobile visits for total visits for Coca Cola vs Pepsi in 2021 ? Convert date from varchar to date using to date function","SELECT company_name,
       sum(total_visits) as total_visits_2021,
       sum(mobile_visits) as mobile_visits_2021
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%coca-cola%'
    or company_name ilike '%pepsi%'
   and to_date(date, 'YYYY-MM-DD') between '2021-01-01'
   and '2021-12-31'
GROUP BY company_name
ORDER BY company_name"
"Which domains had the highest growth in mobile traffic in 2022 compared to 2021?","SELECT domain,
       case when mobile_visits_2021 = 0 then null
            else (mobile_visits_2022 - mobile_visits_2021) / mobile_visits_2021 end as mobile_growth
FROM   (SELECT domain,
               sum(case when date between '2021-11-01' and
                             '2021-11-30' then mobile_visits
                        else 0 end) as mobile_visits_2021,
               sum(case when date between '2022-11-01' and
                             '2022-11-30' then mobile_visits
                        else 0 end) as mobile_visits_2022
        FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
        GROUP BY domain) subquery
ORDER BY mobile_growth desc limit 10"
"which 5 companies have more desktop visits than mobile visits in 2022","SELECT company_name,
       sum(CAST(desktop_visits AS FLOAT)) as desktop_visits,
       sum(CAST(mobile_visits AS FLOAT)) as mobile_visits
FROM s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE date BETWEEN '2022-01-01' AND '2022-12-31'
GROUP BY company_name 
HAVING sum(CAST(desktop_visits AS FLOAT)) > sum(CAST(mobile_visits AS FLOAT))
ORDER BY desktop_visits-mobile_visits DESC 
LIMIT 5; "
"What is the highest traffic domain for each ticker?","SELECT ticker,
       domain,
       max(total_visits) as max_traffic
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
GROUP BY ticker, domain"
"which domains received the highest amount of traffic?","SELECT domain,
       sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
GROUP BY domain
ORDER BY total_visits desc limit 10"
"what are average mobile visit durations of netflix v/s desktop visit duration from year 2018 to 2021.","SELECT extract(year
FROM   to_date(date, 'YYYY-MM-DD')) as year, avg(mobile_avg_visit_duration) as avg_mobile_visit_duration, avg(desktop_avg_visit_duration) as avg_desktop_visit_duration
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%netflix%')
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2021-12-31'
GROUP BY 1;"
"Plot year on year % growth and absolute growth of mobile visits on Alphabet .","SELECT year,
       mobile_visits - lag(mobile_visits) OVER (ORDER BY year) as mobile_visits_growth,
       round((mobile_visits - lag(mobile_visits) OVER (ORDER BY year))*100.0 / nullif(lag(mobile_visits) OVER (ORDER BY year), 0),
             2) as mobile_visits_growth_percentage
FROM   (SELECT date_trunc('year', to_date(date, 'YYYY-MM-DD')) as year,
               sum(mobile_visits) as mobile_visits
        FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
        WHERE  company_name ilike '%alphabet%'
           and to_date(date, 'YYYY-MM-DD') between '2010-01-01'
           and '2021-12-31'
        GROUP BY date_trunc('year', to_date(date, 'YYYY-MM-DD')))
ORDER BY year"
"Compare summary stats of nest.com to ring.com","```
SELECT 
    'nest.com' AS SITE, 
    COUNT(DISTINCT DATE) AS NUM_DAYS,
    SUM(TOTAL_VISITS) AS TOTAL_VISITS,
    AVG(TOTAL_AVG_VISIT_DURATION) AS AVG_VISIT_DURATION,
    AVG(TOTAL_PAGES_PER_VISIT) AS AVG_PAGES_PER_VISIT,
    AVG(TOTAL_BOUNCE_RATE) AS AVG_BOUNCE_RATE
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500
WHERE DOMAIN = 'nest.com'
UNION ALL
SELECT 
    'ring.com' AS SITE, 
    COUNT(DISTINCT DATE) AS NUM_DAYS,
    SUM(TOTAL_VISITS) AS TOTAL_VISITS,
    AVG(TOTAL_AVG_VISIT_DURATION) AS AVG_VISIT_DURATION,
    AVG(TOTAL_PAGES_PER_VISIT) AS AVG_PAGES_PER_VISIT,
    AVG(TOTAL_BOUNCE_RATE) AS AVG_BOUNCE_RATE
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500
WHERE DOMAIN = 'ring.com'
```"
"which 5 companies have the highest avg visit duration in 2021 ?","SELECT company_name,
       avg(total_avg_visit_duration) as avg_duration
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  to_date(date, 'YYYY-MM-DD') between '2021-01-01'
   and '2021-12-31'
GROUP BY company_name
ORDER BY avg_duration desc limit 5;"
"Which are the 5 companies with the biggest difference in terms of desktop and mobile site visits in 2022?","SELECT company_name,
       sum(cast(desktop_visits as float)) as desktop_visits,
       sum(cast(mobile_visits as float)) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date between '2022-01-01'
   and '2022-12-31'
GROUP BY company_name having sum(cast(desktop_visits as float)) > sum(cast(mobile_visits as float))
ORDER BY desktop_visits-mobile_visits desc limit 5;"
"What's the most recent date in the dataset?","SELECT max(date)
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500"
"which 5 companies have the highest page visits duration in 2021 ?","SELECT company_name,
       sum(total_visits) as visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  to_date(date, 'YYYY-MM-DD') between '2021-01-01'
   and '2021-12-31'
GROUP BY company_name
ORDER BY visits desc limit 5;"
"what are the year on year total visits on ebay and amazon from 2018 to 2023 ? Convert varchar to date using to date function , Plot a line chart ","SELECT company_name,
       extract(year
FROM   to_date(date, 'YYYY-MM-DD')) as year, sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%ebay%'
    or company_name ilike '%amazon%')
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2023-12-31'
GROUP BY company_name, extract(year
FROM   to_date(date, 'YYYY-MM-DD'))
ORDER BY company_name, year;"
"which  are the top 10 domains that  received the highest amount of traffic in the month of November on the 26th and 29th?","SELECT domain,
       sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date in ('2021-11-26', '2021-11-29')
GROUP BY domain
ORDER BY total_visits desc limit 10"
"which domains received the highest amount of traffic in the month of November after the fourth Thursday?","SELECT domain,
       sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date in ('2021-11-26', '2021-11-26')
GROUP BY domain
ORDER BY total_visits desc"
"what are the year on year total visits on Tesla and ford from 2018 to 2021 ? Convert varchar to date using to date function , Plot a line chart ","SELECT company_name,
       extract(year
FROM   to_date(date, 'YYYY-MM-DD')) as year, sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%tesla%'
    or company_name = 'Ford')
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2021-12-31'
GROUP BY company_name, extract(year
FROM   to_date(date, 'YYYY-MM-DD'))
ORDER BY company_name, year;"
"what are mobile visits for total visits for Coca Cola vs Pepsi in year on year from 2010 to 2021 ? Convert date from varchar to date using to date function","SELECT company_name,
       date_trunc('year', to_date(date, 'YYYY-MM-DD')) as year,
       sum(total_visits) as total_visits,
       sum(mobile_visits) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%coca-cola%'
    or company_name ilike '%pepsi%'
   and date between '2010-01-01'
   and '2021-12-31'
GROUP BY company_name, date_trunc('year', to_date(date, 'YYYY-MM-DD'))
ORDER BY company_name, year"
"Which 10 domains received the highest amount of traffic on Black Friday in 2021? Show the associated tickers","SELECT domain,
       ticker,
       sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date = '2021-11-26'
GROUP BY domain, ticker
ORDER BY total_visits desc limit 10"
"which are the top 10 domains that received the highest amount of traffic in the month of November on the 26th or 29th?","SELECT domain,
       sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date = '2021-11-26' or date = '2021-11-29'
GROUP BY domain
ORDER BY total_visits desc limit 10"
"what are average mobile visit durations of netflix v/s desktop visit duration from year 2018 to 2021 ?","SELECT extract(year FROM to_date(date, 'YYYY-MM-DD')) as year,
       avg(mobile_avg_visit_duration) as avg_mobile_visit_duration,
       avg(desktop_avg_visit_duration) as avg_desktop_visit_duration
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%netflix%')
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2021-12-31'
GROUP BY 1;"
"which company had more desktop visits than mobile visits in 2020, but had more mobile visits than desktop visits in 2021 ? ","with desktop_visits as (SELECT company_name,
                               sum(case when date between '2020-01-01' and
                                             '2020-12-31' then desktop_visits
                                        else 0 end) as desktop_visits_2020,
                               sum(case when date between '2021-01-01' and
                                             '2021-12-31' then desktop_visits
                                        else 0 end) as desktop_visits_2021
                        FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                        GROUP BY company_name having sum(case when date between '2020-01-01' and '2020-12-31' then mobile_visits else 0 end) < desktop_visits_2020 and sum(case when date between '2021-01-01' and '2021-12-31' then mobile_visits else 0 end) > desktop_visits_2021)
SELECT company_name
FROM   desktop_visits;"
"Which domains  had the highest  mobile traffic in 2022 and 2021?","with mobile_visits as (SELECT domain,
                              sum(case when date between '2021-01-01' and
                                            '2021-12-31' then mobile_visits
                                       else 0 end) as mobile_visits_2021,
                              sum(case when date between '2022-01-01' and
                                            '2022-12-31' then mobile_visits
                                       else 0 end) as mobile_visits_2022
                       FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                       GROUP BY domain)
SELECT domain,
       mobile_visits_2021,
       mobile_visits_2022
FROM   mobile_visits
ORDER BY (mobile_visits_2021 + mobile_visits_2022) desc limit 10;"
"select the top 5 and bottom 5 domains based on  yoy growth rate.","with traffic_data as (SELECT domain,
                             extract(year
                      FROM   cast(date as date)) as year, sum(total_visits) as total_visits
                      FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                      GROUP BY domain, extract(year
                      FROM   cast(date as date))), yoy_data as (SELECT current_year.domain,
                                                 current_year.year,
                                                 (current_year.total_visits - previous_year.total_visits) / cast(previous_year.total_visits as float) as yoy_growth
                                          FROM   traffic_data as current_year join traffic_data as previous_year
                                                  ON current_year.domain = previous_year.domain and
                                                     current_year.year = previous_year.year + 1), ranked_data as (SELECT domain,
                                                                    avg(yoy_growth) as avg_yoy_growth
                                                             FROM   yoy_data
                                                             GROUP BY domain)
SELECT domain,
       avg_yoy_growth
FROM   ranked_data
ORDER BY avg_yoy_growth desc limit 5;"
"Plot year on year % growth of mobile visits on Alphabet ","SELECT date_trunc('year', to_date(date, 'YYYY-MM-DD')) as year,
       sum(mobile_visits) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%alphabet%'
   and date_trunc('year', to_date(date, 'YYYY-MM-DD')) between '2010-01-01'
   and '2021-12-31'
GROUP BY date_trunc('year', to_date(date, 'YYYY-MM-DD'))
ORDER BY year;"
"Which domains  had the highest  mobile traffic between 2022 or 2021?","SELECT domain,
       sum(case when date between '2021-01-01' and
                     '2021-12-31' then mobile_visits
                else 0 end) as mobile_visits_2021,
       sum(case when date between '2022-01-01' and
                     '2022-12-31' then mobile_visits
                else 0 end) as mobile_visits_2022,
(mobile_visits_2022 - mobile_visits_2021) / mobile_visits_2021 * 100 as perc_change
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
GROUP BY domain
ORDER BY mobile_visits_2022 desc limit 10"
"which 5 companies have more desktop visits than mobile visits in 2020, rank by highest to lowest desktop views","The corrected SQL query is:

```
SELECT company_name,
       sum(CAST(desktop_visits AS FLOAT)) as desktop_visits,
       sum(CAST(mobile_visits AS FLOAT)) as mobile_visits
FROM s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE date BETWEEN '2020-01-01' AND '2020-12-31'
GROUP BY company_name 
HAVING sum(CAST(desktop_visits AS FLOAT)) > sum(CAST(mobile_visits AS FLOAT))
ORDER BY desktop_visits DESC 
LIMIT 5; 
```

I removed the `SUM` function from the `ORDER BY` clause since it was already used in the `SELECT` clause. This should fix the error."
"Plot year on year % growth and absolute growth of mobile visits on Alphabet ","SELECT date_trunc('year', to_date(date, 'YYYY-MM-DD')) as year,
       (sum(mobile_visits) - lag(sum(mobile_visits), 1) OVER (ORDER BY date_trunc('year', to_date(date, 'YYYY-MM-DD')))) as mobile_growth,
       (sum(mobile_visits) - lag(sum(mobile_visits), 1) OVER (ORDER BY date_trunc('year', to_date(date, 'YYYY-MM-DD')))) / lag(sum(mobile_visits), 1) OVER (ORDER BY date_trunc('year', to_date(date, 'YYYY-MM-DD'))) * 100 as mobile_growth_percentage
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%alphabet%'
   and to_date(date, 'YYYY-MM-DD') between '2010-01-01'
   and '2021-12-31'
GROUP BY date_trunc('year', to_date(date, 'YYYY-MM-DD'))
ORDER BY year;"
"select the top 10 fastest-growing or slowest-growing domains based on YoY growth rate","The corrected SQL code is:

```
WITH traffic_data AS (
    SELECT 
        domain,
        EXTRACT(YEAR FROM CAST(date AS DATE)) AS year,
        SUM(total_visits) AS total_visits
    FROM s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
    GROUP BY domain, EXTRACT(YEAR FROM CAST(date AS DATE))
),
yoy_data AS (
    SELECT 
        current_year.domain,
        current_year.year,
        (current_year.total_visits - previous_year.total_visits) / CAST(previous_year.total_visits AS FLOAT) AS yoy_growth
    FROM traffic_data AS current_year
    JOIN traffic_data AS previous_year
    ON current_year.domain = previous_year.domain
    AND current_year.year = previous_year.year + 1
),
ranked_data AS (
    SELECT 
        domain,
        AVG(yoy_growth) AS avg_yoy_growth
    FROM yoy_data
    GROUP BY domain
)
SELECT 
    domain,
    avg_yoy_growth
FROM ranked_data
ORDER BY avg_yoy_growth DESC
LIMIT 10;
```"
"which 2 companies had the highest abolsute mobile visit growth from 2020 to 2021 ?","with mobile_visits as (SELECT company_name,
                              date_trunc('year', to_date(date, 'YYYY-MM-DD')) as year,
                              sum(mobile_visits) as mobile_visits
                       FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                       WHERE to_date(date, 'YYYY-MM-DD') between '2020-01-01'
                          and '2021-12-31'
                       GROUP BY company_name, year), mobile_visits_growth as (SELECT company_name,
                                                              year,
                                                              mobile_visits,
                                                              lag(mobile_visits) OVER (PARTITION BY company_name
                                                                                       ORDER BY year) as prev_mobile_visits
                                                       FROM   mobile_visits)
SELECT company_name,
       max(mobile_visits - prev_mobile_visits) as max_mobile_growth
FROM   mobile_visits_growth
GROUP BY company_name
ORDER BY max_mobile_growth desc limit 2;"
"Which domains had the highest average visit duration? Limit to the top 100 domains by total traffic","```
SELECT DOMAIN, ROUND(AVG(TOTAL_AVG_VISIT_DURATION),2) AS AVG_DURATION 
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500 
GROUP BY DOMAIN 
ORDER BY SUM(TOTAL_VISITS) DESC 
LIMIT 100
```"
"what are the year on year total visits on Tesla and general mills from 2018 to 2023 ? Convert varchar to date using to date function ","SELECT company_name,
       extract(year
FROM   to_date(date, 'YYYY-MM-DD')) as year, sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%tesla%'
    or company_name ilike '%general mills%')
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2023-12-31'
GROUP BY company_name, extract(year
FROM   to_date(date, 'YYYY-MM-DD'))
ORDER BY company_name, year;"
"what are mobile visits for total visits for Coca Cola vs Pepsi in year on year from 2010 to 2021 ? Convert date from varchar to date using to date function, Plot it on a line chart with year as x axis ","SELECT company_name,
       date_trunc('year', to_date(date, 'YYYY-MM-DD')) as year,
       sum(total_visits) as total_visits,
       sum(mobile_visits) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%coca-cola%'
    or company_name ilike '%pepsi%')
   and date between '2010-01-01'
   and '2021-12-31'
GROUP BY company_name, date_trunc('year', to_date(date, 'YYYY-MM-DD'))
ORDER BY company_name, year;"
"Which are the 5 companies with the biggest difference in terms of desktop and mobile site visits in 2022.","SELECT company_name,
       sum(cast(desktop_visits as float)) as desktop_visits,
       sum(cast(mobile_visits as float)) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date between '2022-01-01'
   and '2022-12-31'
GROUP BY company_name having sum(cast(desktop_visits as float)) > sum(cast(mobile_visits as float))
ORDER BY desktop_visits-mobile_visits desc limit 5;"
"Which domain received the highest amount of traffic on Black Friday in 2022?","SELECT domain,
       sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date = '2022-11-25'
GROUP BY domain
ORDER BY total_visits desc limit 1"
"what are mobile visits for Google  from 2010 to 2021  ? Convert date from varchar to date using to date function ","SELECT sum(mobile_visits) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  company_name ilike '%google%'
   and to_date(date, 'YYYY-MM-DD') between '2010-12-31'
   and '2021-01-01';"
"what are the year on year total visits on Coca Coal and Pepsi from 2018 to 2021 ? Convert varchar to date using to date function ","SELECT company_name,
       extract(year
FROM   to_date(date, 'YYYY-MM-DD')) as year, sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%coca-cola%'
    or company_name ilike '%pepsi%')
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2021-12-31'
GROUP BY company_name, extract(year
FROM   to_date(date, 'YYYY-MM-DD'))
ORDER BY company_name, year;"
"select the top 10 fastest-growing or slowest-growing domains based on YoY growth rate ","with traffic_data as (SELECT domain,
                             extract(year
                      FROM   cast(date as date)) as year, sum(total_visits) as total_visits
                      FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                      GROUP BY domain, extract(year
                      FROM   cast(date as date))), yoy_data as (SELECT current_year.domain,
                                                 current_year.year,
                                                 (current_year.total_visits - previous_year.total_visits) / cast(previous_year.total_visits as float) as yoy_growth
                                          FROM   traffic_data as current_year join traffic_data as previous_year
                                                  ON current_year.domain = previous_year.domain and
                                                     current_year.year = previous_year.year + 1), ranked_data as (SELECT domain,
                                                                    avg(yoy_growth) as avg_yoy_growth
                                                             FROM   yoy_data
                                                             GROUP BY domain)
SELECT domain,
       avg_yoy_growth
FROM   ranked_data
ORDER BY avg_yoy_growth desc limit 10;"
"get the total duration by visits, spent on google.com in 2022 and group by month ","SELECT date_trunc('month', CAST(date AS DATE)) AS month,
       SUM(total_avg_visit_duration * total_visits) AS total_duration
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  domain = 'google.com'
   AND date BETWEEN '2022-01-01' AND '2022-12-31'
GROUP BY month
ORDER BY month ASC;"
"what are different company names ? ","SELECT DISTINCT company_name 
FROM datafeeds.sp_500 "
"what are mobile visits for Google  from 2001 to 2010  ? ","SELECT sum(mobile_visits)
FROM datafeeds.sp_500
WHERE date >= '2001-01-01'
and date <= '2010-01-01'
and company_name ilike '%google%'"
"Show visits to TSLA domains over time","```
SELECT DATE, SUM(TOTAL_VISITS) AS VISITS
FROM S__P_500_BY_DOMAIN_AND_AGGREGATED_BY_TICKERS_SAMPLE.DATAFEEDS.SP_500
WHERE TICKER = 'TSLA'
GROUP BY DATE
ORDER BY DATE ASC
```"
"Which domains had the highest growth in mobile traffic in 2022 and 2021?","Here is the corrected SQL query:

```
SELECT domain,
       CASE 
          WHEN mobile_visits_2020 = 0 THEN NULL 
          ELSE (mobile_visits_2021 - mobile_visits_2020) / mobile_visits_2020 
       END AS mobile_growth
FROM   (SELECT domain,
               sum(case when date between '2020-11-01' and
                             '2020-11-30' then mobile_visits
                        else 0 end) as mobile_visits_2020,
               sum(case when date between '2021-11-01' and
                             '2021-11-30' then mobile_visits
                        else 0 end) as mobile_visits_2021
        FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
        GROUP BY domain) subquery
ORDER BY mobile_growth desc limit 10
```

The error occurred because the initial query was included in the error message."
"which 2 companies have the highest avg visit duration in 2021 ?","SELECT company_name,
       avg(total_avg_visit_duration) as avg_visit_duration
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date between '2021-01-01'
   and '2021-12-31'
GROUP BY company_name
ORDER BY avg_visit_duration desc limit 2;"
"Which are top 10 domains with the highest mobile traffic in the year 2021 and 2022?","SELECT domain,
       sum(case when date between '2021-01-01' and
                     '2021-12-31' then mobile_visits
                else 0 end) as mobile_visits_2021,
       sum(case when date between '2022-01-01' and
                     '2022-12-31' then mobile_visits
                else 0 end) as mobile_visits_2022
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
GROUP BY domain
ORDER BY (mobile_visits_2021 + mobile_visits_2022) desc limit 10"
"which 3 companies have the highest mobile visit duration in the year 2021 ? ","SELECT company_name,
       avg(total_avg_visit_duration) as avg_visit_duration
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date between '2021-01-01'
   and '2021-12-31'
GROUP BY company_name
ORDER BY avg_visit_duration desc limit 3;"
"which 5 companies have more desktop visits than mobile visits, rank by highest to lowest desktop views","Here is the corrected SQL query:

```
SELECT company_name,
       sum(desktop_visits) as desktop_visits,
       sum(mobile_visits) as mobile_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
GROUP BY company_name 
HAVING sum(CAST(desktop_visits AS FLOAT)) > sum(CAST(mobile_visits AS FLOAT))
ORDER BY desktop_visits DESC 
LIMIT 5;
```

The error message indicates that the `SUM()` function in the `HAVING` clause cannot be nested. Therefore, I have removed the `SUM()` function from the `ORDER BY` clause and replaced it with just the column name `desktop_visits`."
"retrieve the top 10 domains with the highest total time spent (visits x duration) in 2022, combining desktop and mobile traffic","I'm sorry but I cannot correct the SQL query without seeing it. Can you please provide the SQL query?"
"Plot year on year % growth and absolute growth of mobile visits on Alphabet.","SELECT year,
       mobile_visits - lag(mobile_visits,
                           1) OVER (ORDER BY year) as mobile_visits_growth,
       round((mobile_visits - lag(mobile_visits, 1) OVER (ORDER BY year)) * 100.0 / nullif(lag(mobile_visits, 1) OVER (ORDER BY year), 0),
             2) as mobile_visits_growth_percentage
FROM   (SELECT date_trunc('year', to_date(date, 'YYYY-MM-DD')) as year,
               sum(mobile_visits) as mobile_visits
        FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
        WHERE  company_name ilike '%alphabet%'
           and to_date(date, 'YYYY-MM-DD') between '2010-01-01'
           and '2021-12-31'
        GROUP BY date_trunc('year', to_date(date, 'YYYY-MM-DD'))) subquery
ORDER BY year"
"what are the year on year total visits on Tesla and general mills from 2018 to 2021 ? Convert varchar to date using to date function ","SELECT company_name,
       extract(year
FROM   to_date(date, 'YYYY-MM-DD')) as year, sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  (company_name ilike '%tesla%'
    or company_name ilike '%general mills%')
   and to_date(date, 'YYYY-MM-DD') between '2018-01-01'
   and '2021-12-31'
GROUP BY company_name, extract(year
FROM   to_date(date, 'YYYY-MM-DD'))
ORDER BY company_name, year;"
"Which domains received the highest amount of traffic on Black Friday in 2021?","SELECT domain,
       sum(total_visits) as total_visits
FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
WHERE  date = '2021-11-26'
GROUP BY domain
ORDER BY total_visits desc"
"What is the percentage change in domains which had the highest  mobile traffic between 2022 and 2021?","with mobile_visits as (SELECT domain,
                              sum(case when date between '2021-11-01' and
                                            '2021-11-30' then mobile_visits
                                       else 0 end) as mobile_visits_2021,
                              sum(case when date between '2022-11-01' and
                                            '2022-11-30' then mobile_visits
                                       else 0 end) as mobile_visits_2022
                       FROM   s__p_500_by_domain_and_aggregated_by_tickers_sample.datafeeds.sp_500
                       GROUP BY domain), top_domains as (SELECT domain,
                                         mobile_visits_2021,
                                         mobile_visits_2022,
                                         rank() OVER (ORDER BY mobile_visits_2022 desc) as rank_2022,
                                         rank() OVER (ORDER BY mobile_visits_2021 desc) as rank_2021
                                  FROM   mobile_visits)
SELECT top 10 t.domain,
       round((t.mobile_visits_2022 - t.mobile_visits_2021) / t.mobile_visits_2021 * 100,
             2) as mobile_traffic_percentage_change
FROM   top_domains t
WHERE  t.rank_2022 <= 10
   and t.rank_2021 <= 10
ORDER BY mobile_traffic_percentage_change desc"
